<!DOCTYPE html>
<html lang="en">
	<head>
		<title>MC viewer</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="/js/jquery.js"></script>
		<script src="/js/vue.min.js"></script>
		<script src="/js/moment.js"></script>
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/spinner.css">
	</head>
	<body>
		<div id="mcapp" class="container">
			<div class="spinner" v-show="loading"></div>
			<div class="row justify-content-md-center">
				<div class="col col-xs-12 col-sm-12 col-md-8 container" v-show="!loading">
					<div class="input-group">
						<input id="id" type="text" v-model="id" class="form-control" @keyup.enter="query">
						<span class="input-group-btn">
							<button class="btn btn-default" @click="query">Query</button>
						</span>
					</div>
					<div class="form-group">
						<label for="uuid">uuid:</label>
						<input id="uuid" type="text" :value="uuid" class="form-control" disabled="true">
					</div>
					<img :src="skinurl" class="mx-auto d-block">
					<br>
					<button class="btn btn-default col-md-12 col-xs-12 col-sm-12 " v-on:click="skindl">Download skin</button>
					<div class="table-responsive">
						<table class="table">
							<thead>
								<td><strong>name</strong></td>
								<td><strong>time</strong></td>
							</thead>
							<tbody>
								<tr v-for="row in list">
									<td>{{row.name}}</td>
									<td>{{row.time}}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<script>
			moment.locale(navigator.language);
			var mcapp=new Vue({
				el: '#mcapp',
				data: {
					id: 'notch',
					skinurl: 'img/notch.png',
					uuid: '069a79f444e94726a5befca90e38aaf5',
					list: [],
					loading: false
				},
				methods: {
					query: function(){
						this.loading=true;
						this.skinurl='https://mcapi.ca/skin/'+this.id;
						$.get('https://minecraft-player-query-w1yw2fehpufe.runkit.sh/'+this.id).then(data=>{
							this.uuid=data.uuid;
							var hs=data.history.map(e=>{
								e.time=moment(e.changedToAt).fromNow();
								return e;
							})
							this.list=hs.slice(1);
							this.loading=false;
						}).catch(e=>{
							alert(e.statusText);
							this.loading=false;
						})
					},
					skindl: function(){
						var a=document.createElement('a');
						a.href='https://mcapi.ca/rawskin/'+this.id;
						a.download=this.id+'.png';
						a.click();
						a.parentElement.removeChild(a);
					}
				}
			});
		</script>
	</body>
</html>